<div class="delete-container">
  @if (auth.isAdmin()) {
    <mat-card>
      <mat-card-header>
        <div mat-card-avatar>
          <mat-icon color="warn">delete_forever</mat-icon>
        </div>
        <mat-card-title>Delete Legislation</mat-card-title>
        <mat-card-subtitle>Permanently remove a bill</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="warning-box">
          <mat-icon>warning</mat-icon>
          <span><strong>Caution:</strong> This action cannot be undone.</span>
        </div>

        <form (submit)="onDelete(); $event.preventDefault()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Select State</mat-label>
            <mat-select
              [ngModel]="selectedState()"
              (ngModelChange)="selectedState.set($event)"
              name="state"
              required
              [disabled]="isDeleting()"
            >
              @for (state of states; track state.value) {
                <mat-option [value]="state.value">{{ state.name }}</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Select Bill to Delete</mat-label>
            <mat-select
              [ngModel]="selectedBillId()"
              (ngModelChange)="selectedBillId.set($event)"
              name="billId"
              required
              [disabled]="!selectedState() || isLoadingBills() || isDeleting()"
            >
              @if (isLoadingBills()) {
                <mat-option disabled>Loading bills...</mat-option>
              }
              @for (bill of availableBills(); track bill.id) {
                <mat-option [value]="bill.id">
                  <strong>{{ bill.number }}</strong
                  >: {{ bill.title | slice: 0 : 40 }}...
                </mat-option>
              }
              @if (!isLoadingBills() && availableBills().length === 0 && selectedState()) {
                <mat-option disabled>No bills found in this state</mat-option>
              }
            </mat-select>
          </mat-form-field>

          <button
            mat-flat-button
            color="warn"
            class="full-width"
            type="submit"
            [disabled]="!selectedState() || !selectedBillId() || isDeleting()"
          >
            @if (isDeleting()) {
              Deleting...
            } @else {
              Delete Bill Permanently
            }
          </button>
        </form>
      </mat-card-content>
    </mat-card>
  } @else {
    <mat-card class="access-denied">
      <mat-card-content>
        <mat-icon color="warn" class="large-icon">lock</mat-icon>
        <h2>Access Denied</h2>
        <p>You do not have administrative privileges to view this page.</p>
      </mat-card-content>
    </mat-card>
  }
</div>
